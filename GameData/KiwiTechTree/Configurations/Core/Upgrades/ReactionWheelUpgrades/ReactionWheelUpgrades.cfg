// Kiwi's Tech Tree Overhaul (Reaction Wheel Upgrades)
// Version 1.2
// Created: 30 January 2021 for KSP 1.9.1 to 1.10.1
// Contributed by Clamp-o-Tron

@PART[*]:HAS[@MODULE[ModuleReactionWheel],#kiwiRWUpgradeType[standard],!RWUpgrade[off]]:FOR[zzzKiwiTechTree]
{
  %pTorqueBase = #$MODULE[ModuleReactionWheel]/PitchTorque$
  %yTorqueBase = #$MODULE[ModuleReactionWheel]/YawTorque$
  %rTorqueBase = #$MODULE[ModuleReactionWheel]/YawTorque$
  
  %RW_EC_useBase = #$MODULE[ModuleReactionWheel]/RESOURCE/rate$
  
  %pTorqueL0 = #$pTorqueBase$
  %pTorqueL0 *= 0.5
  %yTorqueL0 = #$yTorqueBase$
  %yTorqueL0 *= 0.5
  %rTorqueL0 = #$rTorqueBase$
  %rTorqueL0 *= 0.5
  %RW_EC_useL0 = #$RW_EC_useBase$
  %RW_EC_useL0 *= 0.8
  
  %pTorqueL1 = #$pTorqueBase$
  %pTorqueL1 *= 0.75
  %yTorqueL1 = #$yTorqueBase$
  %yTorqueL1 *= 0.75
  %rTorqueL1 = #$rTorqueBase$
  %rTorqueL1 *= 0.75
  %RW_EC_useL1 = #$RW_EC_useBase$
  %RW_EC_useL1 *= 0.9
  
  %pTorqueL3 = #$pTorqueBase$
  %pTorqueL3 *= 2
  %yTorqueL3 = #$yTorqueBase$
  %yTorqueL3 *= 2
  %rTorqueL3 = #$rTorqueBase$
  %rTorqueL3 *= 2
  %RW_EC_useL3 = #$RW_EC_useBase$
  %RW_EC_useL3 *= 1.5
  
  %pTorqueL4 = #$pTorqueBase$
  %pTorqueL4 *= 4
  %yTorqueL4 = #$yTorqueBase$
  %yTorqueL4 *= 4
  %rTorqueL4 = #$rTorqueBase$
  %rTorqueL4 *= 4
  %RW_EC_useL4 = #$RW_EC_useBase$
  %RW_EC_useL4 *= 2
  
  !MODULE[ModuleReactionWheel] {}
  MODULE
  {
    name = ModuleReactionWheel
    PitchTorque = 0
    YawTorque = 0
    RollTorque = 0
    RESOURCE
    {
      name = ElectricCharge
      rate = 0
    }
  }
  
  MODULE
  {
    name = ModuleB9PartSwitch
    moduleID = RWSwitch
    switcherDescription = <TODO LOCALIZATION>
    switcherDescriptionPlural = <TODO LOCALIZATION>
    SUBTYPE
    {
      name = Level0
      // 50% torque, 80% EC use
      title = <TODO LOCALIZATION>
      descriptionSummary = <TODO LOCALIZATION>
      primaryColor = #000d5e
      secondaryColor = #000d5e
      costAdded = <COST TODO>
      MODULE
      {
        IDENTIFIER
        {
          name = ModuleReactionWheel
        }
        DATA
        {
          PitchTorque = #$/pTorqueL0$
          YawTorque = #$/yTorqueL0$
          RollTorque = #$/rTorqueL0$
          RESOURCE
          {
            rate = #$/RW_EC_useL0$
          }
        }
      }
    }
    SUBTYPE
    {
      name = Level1
      // 75% torque, 90% EC use
      title = <TODO LOCALIZATION>
      descriptionSummary = <TODO LOCALIZATION>
      primaryColor = #001599
      secondaryColor = #001599
      upgradeRequired = <TODO TECH LEVELS>
      costAdded = <COST TODO>
      MODULE
      {
        IDENTIFIER
        {
          name = ModuleReactionWheel
        }
        DATA
        {
          PitchTorque = #$/pTorqueL1$
          YawTorque = #$/yTorqueL1$
          RollTorque = #$/rTorqueL1$
          RESOURCE
          {
            rate = #$/RW_EC_useL1$
          }
        }
      }
    }
    SUBTYPE
    {
      name = Level2Default
      // 100% torque, 100% EC use
      title = <TODO LOCALIZATION>
      descriptionSummary = <TODO LOCALIZATION>
      primaryColor = #001aba
      secondaryColor = #001aba
      upgradeRequired = <TODO TECH LEVELS>
      costAdded = <COST TODO>
      MODULE
      {
        IDENTIFIER
        {
          name = ModuleReactionWheel
        }
        DATA
        {
          PitchTorque = #$/pTorqueBase$
          YawTorque = #$/yTorqueBase$
          RollTorque = #$/rTorqueBase$
          RESOURCE
          {
            rate = #$/RW_EC_useBase$
          }
        }
      }
    }
    SUBTYPE
    {
      name = Level3
      // 200% torque, 150% EC use
      title = <TODO LOCALIZATION>
      descriptionSummary = <TODO LOCALIZATION>
      primaryColor = #001fdb
      secondaryColor = #001fdb
      upgradeRequired = <TODO TECH LEVELS>
      addedCost = <COST TODO>
      MODULE
      {
        IDENTIFIER
        {
          name = ModuleReactionWheel
        }
        DATA
        {
          PitchTorque = #$/pTorqueL3$
          YawTorque = #$/yTorqueL3$
          RollTorque = #$/rTorqueL3$
          RESOURCE
          {
            rate = #$/RW_EC_useL3$
          }
        }
      }
    }
    SUBTYPE
    {
      name = Level4
      // 400% torque, 200% EC use
      title = <TODO LOCALIZATION>
      descriptionSummary = <TODO LOCALIZATION>
      primaryColor = #3b50d1
      secondaryColor = #3b50d1
      upgradeRequired = <TODO TECH LEVELS>
      costAdded = <COST TODO>
      MODULE
      {
        IDENTIFIER
        {
          name = ModuleReactionWheel
        }
        DATA
        {
          PitchTorque = #$/pTorqueL4$
          YawTorque = #$/yTorqueL4$
          RollTorque = #$/rTorqueL4$
          RESOURCE
          {
            rate = #$/RW_EC_useL4$
          }
        }
      }
    }
  }
}
